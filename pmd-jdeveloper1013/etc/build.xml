<project name="pmd-jdeveloper1013" default="compile" basedir="../">

	<property name="config" value="config/"/>
	<property name="src" value="src/"/>
	<property name="etc" value="etc/"/>
	<property name="pmdjar" value="pmd-3.3.jar"/>
	<property name="pluginversion" value="1.7"/>
    <property name="bundle.jarname" value="net.sourceforge.pmd.jdeveloper.${pluginversion}.jar"/>
	<property name="jdeveloper.install.dir" value="c:/data/jdev1013/jdev/lib/ext/${ant.project.name}-${pluginversion}"/>


	<path id="project.class.path">
		<pathelement location="lib/${pmdjar}"/>
		<pathelement location="lib/myjdevdeps.jar"/>
		<pathelement location="lib/javatools.jar"/>
		<pathelement location="lib/ide.jar"/>
		<pathelement location="build"/>
	</path>

    <target name="delete">
        <delete file="lib/${ant.project.name}.jar"/>
        <delete file="${jdeveloper.install.dir}/${ant.project.name}.jar"/>
		<delete dir="build"/>
        <mkdir dir="build"/>
    </target>

	<target name="compile">
		<javac
			srcdir="${src}"	destdir="build"	debug="on" deprecation="on">
			<classpath refid="project.class.path"/>
		</javac>
	</target>

    <target name="jar" depends="compile">
        <delete dir="build/META-INF/"/>
        <mkdir dir="build/META-INF"/>
        <copy file="etc/extension.xml" todir="build/META-INF/"/>
        <jar jarfile="lib/${bundle.jarname}">
			<fileset dir="build" excludes="**/*.di,**/*.i"/>
		</jar>
    </target>

	<target name="deploy" depends="delete,jar">
        <mkdir dir="${jdeveloper.install.dir}/lib"/>
        <copy file="lib/${ant.project.name}-${pluginversion}.jar" todir="${jdeveloper.install.dir}/lib"/>
        <copy file="lib/${pmdjar}" todir="${jdeveloper.install.dir}/lib"/>
        <copy file="lib/jaxen-1.1-beta-7.jar" todir="${jdeveloper.install.dir}/lib"/>
	</target>

    <target name="release" depends="clean,jar">
        <mkdir dir="tmp/${ant.project.name}-${pluginversion}/lib"/>
        <copy file="lib/${ant.project.name}-${pluginversion}.jar" todir="tmp/${ant.project.name}-${pluginversion}/lib/"/>
        <copy file="lib/${pmdjar}" todir="tmp/${ant.project.name}-${pluginversion}/lib/"/>
        <copy file="lib/jaxen-1.1-beta-7.jar" todir="tmp/${ant.project.name}-${pluginversion}/lib"/>
        <zip zipfile="${ant.project.name}-bin-${pluginversion}.zip" basedir="tmp/"/>
        <move file="${ant.project.name}-bin-${pluginversion}.zip" todir="/home/tom/tmp"/>
        <delete dir="tmp"/>
    </target>

	<target name="clean" depends="delete,compile">
	</target>

    <target name="tomserver" depends="release">
        <echo message="Uploading zip file"/>
        <exec executable="scp" os="Linux">
            <arg line=" /home/tom/tmp/${ant.project.name}-bin-${pluginversion}.zip tom@infoether.com:public_html/"/>
        </exec>
    </target>

 <target name="bundle" depends="clean,jar">
     <delete>
         <fileset dir="/home/tom/jdev1013/jdev/extensions/" includes="jaxen*.jar,*pmd*"/>
     </delete>
    <delete dir="/home/tom/jdev1013/jdev/extensions/net.sourceforge.pmd.jdeveloper.1.7"/>

    <delete dir="update-center-bundle/"/>

    <mkdir dir="update-center-bundle/META-INF"/>
    <copy file="etc/bundle.xml" todir="update-center-bundle/META-INF/"/>
    <copy file="etc/center.xml" todir="update-center-bundle/"/>
    <copy file="lib/${bundle.jarname}" todir="update-center-bundle/"/>
    <copy file="lib/${pmdjar}" todir="update-center-bundle/net.sourceforge.pmd.jdeveloper.${pluginversion}/lib/"/>
    <copy file="lib/jaxen-1.1-beta-7.jar" todir="update-center-bundle/net.sourceforge.pmd.jdeveloper.${pluginversion}/lib/"/>
    <zip destfile="update-center-bundle/pmd-jdeveloper1013-1.7.zip" basedir="update-center-bundle">
      <exclude name="center.xml"/>
    </zip>
    <copy file="update-center-bundle/pmd-jdeveloper1013-1.7.zip" todir="/home/tom/jdevhome/"/>

    <delete>
        <fileset dir="update-center-bundle" includes="*.jar"/>
    </delete>
    <delete dir="update-center-bundle/net.sourceforge.pmd.jdeveloper.${pluginversion}"/>
    <delete dir="update-center-bundle/lib"/>
    <delete dir="update-center-bundle/META-INF"/>
  </target>

</project>
